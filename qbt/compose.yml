version: '3'

services:
  app:
    image: emmercm/qbittorrent
    restart: always
    entrypoint:
      - qbittorrent-nox
    command:
      - --webui-port=8080
      - --torrenting-port=${LISTENPORT:-6881}
    environment:
      - TZ=${TZ:-America/New_York}
      - PING_IPS=${PING_IPS:-http://one.one.one.one}
      - IP_URL=${IP_URL:-http://whatismyip.akamai.com}
    volumes:
      - config:/config
      - data:/data
      - tmp:/incomplete
      - ${QBT_DOWNLOAD:-./downloads}:/downloads
    labels:
          - traefik.http.routers.qbt.rule=Host(`${QBT_DOMAIN}`)
          - traefik.http.routers.qbt.tls=${QBT_TLS:-true}
          - traefik.http.routers.qbt.tls.certresolver=acmeResolver
          - traefik.http.services.qbt-service.loadbalancer.server.port=8080
    ports:
      - ${LISTENPORT:-6881}:${LISTENPORT:-6881}
      - ${LISTENPORT:-6881}:${LISTENPORT:-6881}/udp
    networks:
      - proxy

volumes:
  config:
  data:
  tmp:

networks:
  proxy:
    external: true
